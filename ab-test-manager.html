<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A/B Test Manager - CampaignPulse</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #ec4899, #f97316); color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .test-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .control-card { background: white; padding: 20px; border-radius: 8px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #ec4899; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px; }
        button:hover { background: #db2777; }
        .variant-section { background: #f8fafc; padding: 15px; border-radius: 4px; margin: 10px 0; border-left: 4px solid #ec4899; }
        .variant-header { display: flex; justify-content: between; align-items: center; margin-bottom: 10px; }
        .variant-label { font-weight: bold; color: #ec4899; }
        .add-variant { background: #10b981; }
        .add-variant:hover { background: #059669; }
        .active-tests { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .test-item { border: 1px solid #e5e7eb; padding: 20px; margin: 15px 0; border-radius: 8px; }
        .test-header { display: flex; justify-content: between; align-items: center; margin-bottom: 15px; }
        .test-name { font-size: 18px; font-weight: bold; }
        .test-status { padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        .status-running { background: #dcfce7; color: #166534; }
        .status-completed { background: #dbeafe; color: #1e40af; }
        .status-paused { background: #fef3c7; color: #92400e; }
        .test-metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 15px 0; }
        .metric-box { text-align: center; padding: 10px; background: #f8fafc; border-radius: 4px; }
        .metric-value { font-size: 20px; font-weight: bold; color: #ec4899; }
        .metric-label { font-size: 12px; color: #6b7280; }
        .variants-comparison { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0; }
        .variant-card { background: white; border: 2px solid #f3f4f6; padding: 15px; border-radius: 8px; text-align: center; }
        .variant-card.winner { border-color: #10b981; background: #f0fdf4; }
        .variant-name { font-weight: bold; margin-bottom: 10px; }
        .variant-metrics { font-size: 14px; }
        .conversion-rate { font-size: 24px; font-weight: bold; color: #ec4899; margin: 10px 0; }
        .confidence-level { font-size: 12px; padding: 4px 8px; border-radius: 4px; }
        .confidence-high { background: #dcfce7; color: #166534; }
        .confidence-medium { background: #fef3c7; color: #92400e; }
        .confidence-low { background: #fecaca; color: #991b1b; }
        .test-actions { display: flex; gap: 10px; margin-top: 15px; }
        .action-btn { padding: 8px 16px; font-size: 12px; border-radius: 4px; }
        .results-section { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .chart-container { height: 300px; margin: 20px 0; }
        .statistical-significance { background: #f0f9ff; border: 1px solid #0ea5e9; padding: 15px; border-radius: 4px; margin: 15px 0; }
        .significance-title { font-weight: bold; color: #0ea5e9; margin-bottom: 5px; }
        .significance-details { font-size: 14px; color: #0f172a; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ A/B Test Manager</h1>
            <p>Create, manage, and analyze A/B tests to optimize campaign performance</p>
        </div>

        <div class="test-controls">
            <div class="control-card">
                <h2>Create New A/B Test</h2>
                <form id="testForm">
                    <div class="form-group">
                        <label>Test Name</label>
                        <input type="text" id="testName" placeholder="Email Subject Line Test" required>
                    </div>
                    <div class="form-group">
                        <label>Campaign</label>
                        <select id="testCampaign" required>
                            <option value="">Select Campaign</option>
                            <option value="email-newsletter">Email Newsletter</option>
                            <option value="google-ads">Google Ads</option>
                            <option value="facebook-ads">Facebook Ads</option>
                            <option value="instagram-ads">Instagram Ads</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Test Type</label>
                        <select id="testType">
                            <option value="subject-line">Subject Line</option>
                            <option value="ad-creative">Ad Creative</option>
                            <option value="landing-page">Landing Page</option>
                            <option value="cta-button">CTA Button</option>
                            <option value="audience">Audience</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Traffic Split (%)</label>
                        <input type="number" id="trafficSplit" value="50" min="10" max="90">
                    </div>
                    <div class="form-group">
                        <label>Test Duration (days)</label>
                        <input type="number" id="testDuration" value="14" min="3" max="60">
                    </div>
                    <button type="submit">Create A/B Test</button>
                </form>
            </div>

            <div class="control-card">
                <h2>Test Variants</h2>
                <div id="variantsContainer">
                    <div class="variant-section">
                        <div class="variant-header">
                            <div class="variant-label">Variant A (Control)</div>
                        </div>
                        <textarea id="variantA" placeholder="Enter control version content..." rows="3"></textarea>
                    </div>
                    <div class="variant-section">
                        <div class="variant-header">
                            <div class="variant-label">Variant B</div>
                        </div>
                        <textarea id="variantB" placeholder="Enter test version content..." rows="3"></textarea>
                    </div>
                </div>
                <button class="add-variant" onclick="addVariant()">+ Add Variant</button>
            </div>
        </div>

        <div class="active-tests">
            <h2>Active A/B Tests</h2>
            <div id="activeTestsList"></div>
        </div>

        <div class="results-section">
            <h2>Test Performance Analysis</h2>
            <div class="chart-container">
                <canvas id="testResultsChart"></canvas>
            </div>
            
            <div class="statistical-significance">
                <div class="significance-title">Statistical Significance Analysis</div>
                <div class="significance-details" id="significanceAnalysis">
                    Select a test to view statistical significance analysis
                </div>
            </div>
        </div>
    </div>

    <script>
        let testResultsChart;
        let variantCount = 2;
        let activeTests = [
            {
                id: 1,
                name: 'Email Subject Line Test',
                campaign: 'Email Newsletter',
                type: 'subject-line',
                status: 'running',
                startDate: '2024-01-01',
                duration: 14,
                trafficSplit: 50,
                variants: [
                    {
                        name: 'Control',
                        content: 'Get 50% Off This Weekend Only!',
                        visitors: 2450,
                        conversions: 147,
                        conversionRate: 6.0,
                        confidence: 95
                    },
                    {
                        name: 'Variant B',
                        content: 'Limited Time: Save 50% Today!',
                        visitors: 2380,
                        conversions: 190,
                        conversionRate: 8.0,
                        confidence: 98
                    }
                ]
            },
            {
                id: 2,
                name: 'Google Ads Creative Test',
                campaign: 'Google Ads',
                type: 'ad-creative',
                status: 'completed',
                startDate: '2023-12-15',
                duration: 21,
                trafficSplit: 50,
                variants: [
                    {
                        name: 'Control',
                        content: 'Buy Now - Free Shipping',
                        visitors: 5200,
                        conversions: 312,
                        conversionRate: 6.0,
                        confidence: 99
                    },
                    {
                        name: 'Variant B',
                        content: 'Shop Today - Free Delivery',
                        visitors: 5150,
                        conversions: 268,
                        conversionRate: 5.2,
                        confidence: 85
                    }
                ]
            },
            {
                id: 3,
                name: 'Facebook CTA Button Test',
                campaign: 'Facebook Ads',
                type: 'cta-button',
                status: 'paused',
                startDate: '2024-01-10',
                duration: 10,
                trafficSplit: 60,
                variants: [
                    {
                        name: 'Control',
                        content: 'Learn More',
                        visitors: 1200,
                        conversions: 48,
                        conversionRate: 4.0,
                        confidence: 65
                    },
                    {
                        name: 'Variant B',
                        content: 'Get Started',
                        visitors: 800,
                        conversions: 40,
                        conversionRate: 5.0,
                        confidence: 72
                    }
                ]
            }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            setupTestForm();
            displayActiveTests();
            initializeTestResultsChart();
            startRealTimeUpdates();
        });

        function setupTestForm() {
            document.getElementById('testForm').addEventListener('submit', (e) => {
                e.preventDefault();
                createABTest();
            });
        }

        function createABTest() {
            const name = document.getElementById('testName').value;
            const campaign = document.getElementById('testCampaign').value;
            const type = document.getElementById('testType').value;
            const trafficSplit = parseInt(document.getElementById('trafficSplit').value);
            const duration = parseInt(document.getElementById('testDuration').value);
            const variantA = document.getElementById('variantA').value;
            const variantB = document.getElementById('variantB').value;

            if (!name || !campaign || !variantA || !variantB) {
                alert('Please fill in all required fields');
                return;
            }

            const newTest = {
                id: activeTests.length + 1,
                name,
                campaign,
                type,
                status: 'running',
                startDate: new Date().toISOString().split('T')[0],
                duration,
                trafficSplit,
                variants: [
                    {
                        name: 'Control',
                        content: variantA,
                        visitors: 0,
                        conversions: 0,
                        conversionRate: 0,
                        confidence: 0
                    },
                    {
                        name: 'Variant B',
                        content: variantB,
                        visitors: 0,
                        conversions: 0,
                        conversionRate: 0,
                        confidence: 0
                    }
                ]
            };

            activeTests.unshift(newTest);
            displayActiveTests();
            
            // Reset form
            document.getElementById('testForm').reset();
            document.getElementById('variantA').value = '';
            document.getElementById('variantB').value = '';
            
            alert(`A/B Test "${name}" created successfully!`);
        }

        function displayActiveTests() {
            const container = document.getElementById('activeTestsList');
            
            if (activeTests.length === 0) {
                container.innerHTML = '<p>No active A/B tests. Create your first test above.</p>';
                return;
            }

            container.innerHTML = activeTests.map(test => {
                const winner = getTestWinner(test);
                const daysRunning = Math.floor((new Date() - new Date(test.startDate)) / (1000 * 60 * 60 * 24));
                
                return `
                    <div class="test-item">
                        <div class="test-header">
                            <div>
                                <div class="test-name">${test.name}</div>
                                <div style="font-size: 14px; color: #6b7280;">
                                    ${test.campaign} ‚Ä¢ ${test.type} ‚Ä¢ Running ${daysRunning} days
                                </div>
                            </div>
                            <div class="test-status status-${test.status}">${test.status.toUpperCase()}</div>
                        </div>

                        <div class="test-metrics">
                            <div class="metric-box">
                                <div class="metric-value">${test.variants.reduce((sum, v) => sum + v.visitors, 0).toLocaleString()}</div>
                                <div class="metric-label">Total Visitors</div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-value">${test.variants.reduce((sum, v) => sum + v.conversions, 0)}</div>
                                <div class="metric-label">Total Conversions</div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-value">${test.trafficSplit}%</div>
                                <div class="metric-label">Traffic Split</div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-value">${test.duration}</div>
                                <div class="metric-label">Duration (days)</div>
                            </div>
                        </div>

                        <div class="variants-comparison">
                            ${test.variants.map(variant => `
                                <div class="variant-card ${winner && winner.name === variant.name ? 'winner' : ''}">
                                    <div class="variant-name">${variant.name}</div>
                                    <div class="conversion-rate">${variant.conversionRate}%</div>
                                    <div class="variant-metrics">
                                        ${variant.visitors.toLocaleString()} visitors<br>
                                        ${variant.conversions} conversions
                                    </div>
                                    <div class="confidence-level ${getConfidenceClass(variant.confidence)}">
                                        ${variant.confidence}% confidence
                                    </div>
                                    ${winner && winner.name === variant.name ? '<div style="color: #10b981; font-weight: bold; margin-top: 5px;">üèÜ WINNER</div>' : ''}
                                </div>
                            `).join('')}
                        </div>

                        <div class="test-actions">
                            <button class="action-btn" onclick="pauseTest(${test.id})" style="background: #f59e0b;">
                                ${test.status === 'paused' ? 'Resume' : 'Pause'}
                            </button>
                            <button class="action-btn" onclick="stopTest(${test.id})" style="background: #dc2626;">Stop Test</button>
                            <button class="action-btn" onclick="viewResults(${test.id})" style="background: #6366f1;">View Results</button>
                            <button class="action-btn" onclick="duplicateTest(${test.id})" style="background: #10b981;">Duplicate</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getTestWinner(test) {
            if (test.status !== 'completed' && test.variants.every(v => v.confidence < 95)) {
                return null;
            }
            
            return test.variants.reduce((prev, current) => 
                (prev.conversionRate > current.conversionRate && prev.confidence >= 95) ? prev : current
            );
        }

        function getConfidenceClass(confidence) {
            if (confidence >= 95) return 'confidence-high';
            if (confidence >= 80) return 'confidence-medium';
            return 'confidence-low';
        }

        function initializeTestResultsChart() {
            const ctx = document.getElementById('testResultsChart').getContext('2d');
            
            // Sample data for the first test
            const testData = activeTests[0];
            
            testResultsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Day 1', 'Day 3', 'Day 5', 'Day 7', 'Day 10', 'Day 12', 'Day 14'],
                    datasets: testData.variants.map((variant, index) => ({
                        label: variant.name,
                        data: generateTestTrendData(variant.conversionRate),
                        borderColor: index === 0 ? '#ec4899' : '#10b981',
                        backgroundColor: index === 0 ? 'rgba(236, 72, 153, 0.1)' : 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: false
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true, position: 'top' },
                        title: { display: true, text: 'Conversion Rate Over Time' }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Conversion Rate (%)' }
                        }
                    }
                }
            });
        }

        function generateTestTrendData(finalRate) {
            const data = [];
            for (let i = 0; i < 7; i++) {
                const variance = (Math.random() - 0.5) * 2;
                const rate = Math.max(0, finalRate + variance - (7 - i) * 0.2);
                data.push(parseFloat(rate.toFixed(1)));
            }
            return data;
        }

        function addVariant() {
            variantCount++;
            const variantsContainer = document.getElementById('variantsContainer');
            
            const newVariant = document.createElement('div');
            newVariant.className = 'variant-section';
            newVariant.innerHTML = `
                <div class="variant-header">
                    <div class="variant-label">Variant ${String.fromCharCode(64 + variantCount)}</div>
                    <button onclick="removeVariant(this)" style="background: #dc2626; padding: 4px 8px; font-size: 12px;">Remove</button>
                </div>
                <textarea placeholder="Enter variant content..." rows="3"></textarea>
            `;
            
            variantsContainer.appendChild(newVariant);
        }

        function removeVariant(button) {
            button.closest('.variant-section').remove();
            variantCount--;
        }

        function pauseTest(testId) {
            const test = activeTests.find(t => t.id === testId);
            if (test) {
                test.status = test.status === 'paused' ? 'running' : 'paused';
                displayActiveTests();
            }
        }

        function stopTest(testId) {
            if (confirm('Are you sure you want to stop this test? This action cannot be undone.')) {
                const test = activeTests.find(t => t.id === testId);
                if (test) {
                    test.status = 'completed';
                    displayActiveTests();
                }
            }
        }

        function viewResults(testId) {
            const test = activeTests.find(t => t.id === testId);
            if (test) {
                const winner = getTestWinner(test);
                const significance = calculateStatisticalSignificance(test);
                
                document.getElementById('significanceAnalysis').innerHTML = `
                    <strong>Test: ${test.name}</strong><br>
                    Statistical Significance: ${significance.isSignificant ? 'YES' : 'NO'} (p-value: ${significance.pValue})<br>
                    Confidence Level: ${significance.confidence}%<br>
                    ${winner ? `Winner: ${winner.name} with ${winner.conversionRate}% conversion rate` : 'No clear winner yet'}<br>
                    Recommendation: ${significance.recommendation}
                `;
                
                // Update chart with test data
                updateChartWithTestData(test);
            }
        }

        function duplicateTest(testId) {
            const test = activeTests.find(t => t.id === testId);
            if (test) {
                const duplicatedTest = {
                    ...test,
                    id: activeTests.length + 1,
                    name: test.name + ' (Copy)',
                    status: 'running',
                    startDate: new Date().toISOString().split('T')[0],
                    variants: test.variants.map(v => ({
                        ...v,
                        visitors: 0,
                        conversions: 0,
                        conversionRate: 0,
                        confidence: 0
                    }))
                };
                
                activeTests.unshift(duplicatedTest);
                displayActiveTests();
                alert('Test duplicated successfully!');
            }
        }

        function calculateStatisticalSignificance(test) {
            const [control, variant] = test.variants;
            const controlRate = control.conversionRate / 100;
            const variantRate = variant.conversionRate / 100;
            
            // Simplified statistical significance calculation
            const pooledRate = (control.conversions + variant.conversions) / (control.visitors + variant.visitors);
            const standardError = Math.sqrt(pooledRate * (1 - pooledRate) * (1/control.visitors + 1/variant.visitors));
            const zScore = Math.abs(controlRate - variantRate) / standardError;
            const pValue = (2 * (1 - normalCDF(Math.abs(zScore)))).toFixed(4);
            
            const isSignificant = zScore > 1.96; // 95% confidence
            const confidence = Math.min(99, Math.max(50, (1 - parseFloat(pValue)) * 100));
            
            let recommendation;
            if (isSignificant && variantRate > controlRate) {
                recommendation = 'Implement the winning variant';
            } else if (isSignificant && controlRate > variantRate) {
                recommendation = 'Keep the control version';
            } else {
                recommendation = 'Continue testing - not enough data for conclusive results';
            }
            
            return {
                isSignificant,
                pValue,
                confidence: confidence.toFixed(0),
                zScore: zScore.toFixed(2),
                recommendation
            };
        }

        function normalCDF(x) {
            // Approximation of normal cumulative distribution function
            return 0.5 * (1 + erf(x / Math.sqrt(2)));
        }

        function erf(x) {
            // Approximation of error function
            const a1 =  0.254829592;
            const a2 = -0.284496736;
            const a3 =  1.421413741;
            const a4 = -1.453152027;
            const a5 =  1.061405429;
            const p  =  0.3275911;
            
            const sign = x >= 0 ? 1 : -1;
            x = Math.abs(x);
            
            const t = 1.0 / (1.0 + p * x);
            const y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
            
            return sign * y;
        }

        function updateChartWithTestData(test) {
            testResultsChart.data.datasets = test.variants.map((variant, index) => ({
                label: variant.name,
                data: generateTestTrendData(variant.conversionRate),
                borderColor: index === 0 ? '#ec4899' : '#10b981',
                backgroundColor: index === 0 ? 'rgba(236, 72, 153, 0.1)' : 'rgba(16, 185, 129, 0.1)',
                tension: 0.4,
                fill: false
            }));
            
            testResultsChart.options.plugins.title.text = `${test.name} - Conversion Rate Over Time`;
            testResultsChart.update();
        }

        function startRealTimeUpdates() {
            setInterval(() => {
                // Simulate real-time test data updates
                activeTests.forEach(test => {
                    if (test.status === 'running') {
                        test.variants.forEach(variant => {
                            const visitorIncrease = Math.floor(Math.random() * 50) + 10;
                            const conversionIncrease = Math.floor(Math.random() * 5);
                            
                            variant.visitors += visitorIncrease;
                            variant.conversions += conversionIncrease;
                            variant.conversionRate = ((variant.conversions / variant.visitors) * 100).toFixed(1);
                            
                            // Update confidence based on sample size
                            if (variant.visitors > 1000) {
                                variant.confidence = Math.min(99, 70 + (variant.visitors / 100));
                            }
                        });
                    }
                });
                
                displayActiveTests();
            }, 30000); // Update every 30 seconds
        }
    </script>
</body>
</html>