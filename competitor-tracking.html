<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Competitor Tracking - CampaignPulse</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #8b5cf6, #06b6d4); color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .tracking-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .control-card { background: white; padding: 20px; border-radius: 8px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #8b5cf6; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #7c3aed; }
        .competitors-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .competitor-card { background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #8b5cf6; }
        .competitor-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .competitor-name { font-size: 18px; font-weight: bold; }
        .status-badge { padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold; }
        .status-active { background: #dcfce7; color: #166534; }
        .status-monitoring { background: #dbeafe; color: #1e40af; }
        .metrics-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .metric-box { text-align: center; padding: 10px; background: #f8fafc; border-radius: 4px; }
        .metric-value { font-size: 16px; font-weight: bold; color: #8b5cf6; }
        .metric-label { font-size: 12px; color: #6b7280; }
        .trend-indicator { font-size: 12px; margin-left: 5px; }
        .trend-up { color: #10b981; }
        .trend-down { color: #ef4444; }
        .analysis-section { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .chart-container { height: 300px; margin: 20px 0; }
        .insights-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
        .insight-card { background: #f0f9ff; border: 1px solid #0ea5e9; padding: 15px; border-radius: 4px; }
        .insight-title { font-weight: bold; color: #0ea5e9; margin-bottom: 5px; }
        .campaign-card { background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #06b6d4; }
        .campaign-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .campaign-name { font-weight: bold; color: #1f2937; }
        .campaign-channel { background: #e5e7eb; padding: 2px 8px; border-radius: 12px; font-size: 12px; }
        .campaign-metrics { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 10px 0; }
        .campaign-metric { text-align: center; }
        .metric-number { font-weight: bold; color: #06b6d4; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŽ¯ Competitor Tracking</h1>
            <p>Monitor competitor campaigns and analyze market positioning with AI-powered insights</p>
            <div style="margin-top: 15px;">
                <button onclick="generateAIReport()" style="background: #10b981; margin-right: 10px;">Generate AI Report</button>
                <button onclick="exportData()" style="background: #f59e0b; margin-right: 10px;">Export Data</button>
                <button onclick="scheduleReport()" style="background: #8b5cf6;">Schedule Reports</button>
            </div>
        </div>

        <div class="tracking-controls">
            <div class="control-card">
                <h2>Add Competitor</h2>
                <form id="competitorForm">
                    <div class="form-group">
                        <label>Competitor Name</label>
                        <input type="text" id="competitorName" placeholder="Competitor Inc." required>
                    </div>
                    <div class="form-group">
                        <label>Website URL</label>
                        <input type="url" id="competitorUrl" placeholder="https://competitor.com" required>
                    </div>
                    <div class="form-group">
                        <label>Industry</label>
                        <select id="competitorIndustry">
                            <option value="e-commerce">E-commerce</option>
                            <option value="saas">SaaS/Tech</option>
                            <option value="finance">Finance</option>
                            <option value="healthcare">Healthcare</option>
                            <option value="retail">Retail</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tracking Channels</label>
                        <select id="trackingChannels" multiple>
                            <option value="google-ads">Google Ads</option>
                            <option value="facebook">Facebook</option>
                            <option value="instagram">Instagram</option>
                            <option value="linkedin">LinkedIn</option>
                            <option value="email">Email</option>
                        </select>
                    </div>
                    <button type="submit">Start Tracking</button>
                </form>
            </div>

            <div class="control-card">
                <h2>Tracking Settings</h2>
                <div class="form-group">
                    <label>Update Frequency</label>
                    <select id="updateFrequency">
                        <option value="hourly">Hourly</option>
                        <option value="daily" selected>Daily</option>
                        <option value="weekly">Weekly</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Alert Threshold</label>
                    <input type="number" id="alertThreshold" value="20" min="5" max="100">
                    <small>% change to trigger alerts</small>
                </div>
                <div class="form-group">
                    <label>Notification Method</label>
                    <select id="notificationMethod">
                        <option value="email">Email</option>
                        <option value="slack">Slack</option>
                        <option value="dashboard">Dashboard Only</option>
                    </select>
                </div>
                <button onclick="updateSettings()">Update Settings</button>
            </div>
        </div>

        <div class="competitors-grid" id="competitorsGrid"></div>

        <div class="analysis-section">
            <h2>Public Campaign Monitoring</h2>
            <div id="campaignsGrid" class="competitors-grid"></div>
        </div>

        <div class="analysis-section">
            <h2>AI-Powered Market Intelligence</h2>
            <div class="chart-container">
                <canvas id="competitorChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="campaignChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="roiChart"></canvas>
            </div>
            
            <div class="insights-grid" id="insightsGrid"></div>
        </div>

        <div class="analysis-section">
            <h2>Competitive A/B Test Insights</h2>
            <div id="abTestInsights"></div>
        </div>

        <div class="analysis-section">
            <h2>Budget vs Competitor Spend</h2>
            <div class="chart-container">
                <canvas id="budgetChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        let competitors = [
            {
                id: 1,
                name: 'TechRival Corp',
                url: 'https://techrival.com',
                industry: 'saas',
                status: 'active',
                channels: ['google-ads', 'linkedin', 'email'],
                metrics: {
                    adSpend: 45000,
                    adSpendTrend: '+12%',
                    estimatedTraffic: 125000,
                    trafficTrend: '+8%',
                    keywordRank: 3.2,
                    rankTrend: '-5%',
                    socialEngagement: 8500,
                    engagementTrend: '+15%'
                },
                campaigns: [
                    { name: 'Q1 Product Launch', channel: 'google-ads', spend: 15000, performance: 'high' },
                    { name: 'LinkedIn B2B Campaign', channel: 'linkedin', spend: 12000, performance: 'medium' }
                ]
            },
            {
                id: 2,
                name: 'MarketLeader Inc',
                url: 'https://marketleader.com',
                industry: 'e-commerce',
                status: 'monitoring',
                channels: ['google-ads', 'facebook', 'instagram'],
                metrics: {
                    adSpend: 78000,
                    adSpendTrend: '+25%',
                    estimatedTraffic: 280000,
                    trafficTrend: '+18%',
                    keywordRank: 1.8,
                    rankTrend: '+12%',
                    socialEngagement: 15200,
                    engagementTrend: '+22%'
                },
                campaigns: [
                    { name: 'Holiday Sale Campaign', channel: 'facebook', spend: 25000, performance: 'high' },
                    { name: 'Google Shopping Ads', channel: 'google-ads', spend: 30000, performance: 'high' }
                ]
            }
        ];

        let competitorChart;
        let campaignChart;
        let roiChart;
        let budgetChart;

        document.addEventListener('DOMContentLoaded', () => {
            setupCompetitorForm();
            displayCompetitors();
            displayPublicCampaigns();
            initializeCompetitorChart();
            initializeCampaignChart();
            initializeROIChart();
            initializeBudgetChart();
            generateAIInsights();
            loadABTestInsights();
            startRealTimeUpdates();
            integrateWithExistingFeatures();
        });

        function setupCompetitorForm() {
            document.getElementById('competitorForm').addEventListener('submit', (e) => {
                e.preventDefault();
                addCompetitor();
            });
        }

        function addCompetitor() {
            const name = document.getElementById('competitorName').value;
            const url = document.getElementById('competitorUrl').value;
            const industry = document.getElementById('competitorIndustry').value;
            const channels = Array.from(document.getElementById('trackingChannels').selectedOptions).map(o => o.value);

            const newCompetitor = {
                id: competitors.length + 1,
                name,
                url,
                industry,
                status: 'monitoring',
                channels,
                metrics: {
                    adSpend: Math.floor(Math.random() * 50000) + 10000,
                    adSpendTrend: '+' + Math.floor(Math.random() * 20) + '%',
                    estimatedTraffic: Math.floor(Math.random() * 200000) + 50000,
                    trafficTrend: '+' + Math.floor(Math.random() * 15) + '%',
                    keywordRank: (Math.random() * 5 + 1).toFixed(1),
                    rankTrend: (Math.random() > 0.5 ? '+' : '-') + Math.floor(Math.random() * 10) + '%',
                    socialEngagement: Math.floor(Math.random() * 10000) + 2000,
                    engagementTrend: '+' + Math.floor(Math.random() * 25) + '%'
                },
                campaigns: []
            };

            competitors.push(newCompetitor);
            displayCompetitors();
            displayPublicCampaigns();
            updateCompetitorChart();
            updateCampaignChart();
            generateInsights();
            
            document.getElementById('competitorForm').reset();
            alert(`Started tracking ${name}!`);
        }

        function displayCompetitors() {
            const container = document.getElementById('competitorsGrid');
            
            container.innerHTML = competitors.map(competitor => `
                <div class="competitor-card">
                    <div class="competitor-header">
                        <div class="competitor-name">${competitor.name}</div>
                        <div class="status-badge status-${competitor.status}">${competitor.status.toUpperCase()}</div>
                    </div>
                    
                    <div style="font-size: 14px; color: #6b7280; margin-bottom: 15px;">
                        ${competitor.industry} â€¢ ${competitor.channels.length} channels
                    </div>

                    <div class="metrics-grid">
                        <div class="metric-box">
                            <div class="metric-value">$${(competitor.metrics.adSpend / 1000).toFixed(0)}K</div>
                            <div class="metric-label">Ad Spend <span class="trend-indicator trend-up">${competitor.metrics.adSpendTrend}</span></div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-value">${(competitor.metrics.estimatedTraffic / 1000).toFixed(0)}K</div>
                            <div class="metric-label">Traffic <span class="trend-indicator trend-up">${competitor.metrics.trafficTrend}</span></div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-value">${competitor.metrics.keywordRank}</div>
                            <div class="metric-label">Avg Rank <span class="trend-indicator ${competitor.metrics.rankTrend.includes('+') ? 'trend-up' : 'trend-down'}">${competitor.metrics.rankTrend}</span></div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-value">${(competitor.metrics.socialEngagement / 1000).toFixed(1)}K</div>
                            <div class="metric-label">Engagement <span class="trend-indicator trend-up">${competitor.metrics.engagementTrend}</span></div>
                        </div>
                    </div>

                    <div style="margin-top: 15px;">
                        <button onclick="viewDetails(${competitor.id})" style="background: #06b6d4; margin-right: 10px;">View Details</button>
                        <button onclick="removeCompetitor(${competitor.id})" style="background: #ef4444;">Remove</button>
                    </div>
                </div>
            `).join('');
        }

        function initializeCompetitorChart() {
            const ctx = document.getElementById('competitorChart').getContext('2d');
            
            competitorChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: competitors.map(c => c.name),
                    datasets: [
                        {
                            label: 'Ad Spend ($K)',
                            data: competitors.map(c => c.metrics.adSpend / 1000),
                            backgroundColor: 'rgba(139, 92, 246, 0.7)',
                            borderColor: '#8b5cf6',
                            borderWidth: 1
                        },
                        {
                            label: 'Traffic (K)',
                            data: competitors.map(c => c.metrics.estimatedTraffic / 1000),
                            backgroundColor: 'rgba(6, 182, 212, 0.7)',
                            borderColor: '#06b6d4',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: { display: true, text: 'Competitor Performance Comparison' }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        function updateCompetitorChart() {
            competitorChart.data.labels = competitors.map(c => c.name);
            competitorChart.data.datasets[0].data = competitors.map(c => c.metrics.adSpend / 1000);
            competitorChart.data.datasets[1].data = competitors.map(c => c.metrics.estimatedTraffic / 1000);
            competitorChart.update();
        }

        function displayPublicCampaigns() {
            const campaigns = [];
            competitors.forEach(competitor => {
                competitor.campaigns = competitor.campaigns || [
                    {
                        name: `${competitor.name} Q1 Campaign`,
                        channel: competitor.channels[0] || 'google-ads',
                        spend: Math.floor(Math.random() * 20000) + 5000,
                        impressions: Math.floor(Math.random() * 500000) + 100000,
                        clicks: Math.floor(Math.random() * 15000) + 3000,
                        conversions: Math.floor(Math.random() * 500) + 100,
                        ctr: ((Math.random() * 3) + 1).toFixed(2),
                        cpc: ((Math.random() * 2) + 0.5).toFixed(2),
                        status: 'active'
                    },
                    {
                        name: `${competitor.name} Brand Campaign`,
                        channel: competitor.channels[1] || 'facebook',
                        spend: Math.floor(Math.random() * 15000) + 3000,
                        impressions: Math.floor(Math.random() * 300000) + 80000,
                        clicks: Math.floor(Math.random() * 10000) + 2000,
                        conversions: Math.floor(Math.random() * 300) + 50,
                        ctr: ((Math.random() * 2.5) + 0.8).toFixed(2),
                        cpc: ((Math.random() * 1.5) + 0.3).toFixed(2),
                        status: 'active'
                    }
                ];
                campaigns.push(...competitor.campaigns.map(c => ({...c, competitor: competitor.name})));
            });

            document.getElementById('campaignsGrid').innerHTML = campaigns.map(campaign => `
                <div class="campaign-card">
                    <div class="campaign-header">
                        <div class="campaign-name">${campaign.name}</div>
                        <div class="campaign-channel">${campaign.channel}</div>
                    </div>
                    <div style="font-size: 12px; color: #6b7280; margin-bottom: 10px;">${campaign.competitor}</div>
                    <div class="campaign-metrics">
                        <div class="campaign-metric">
                            <div class="metric-number">$${(campaign.spend/1000).toFixed(0)}K</div>
                            <div style="font-size: 11px;">Spend</div>
                        </div>
                        <div class="campaign-metric">
                            <div class="metric-number">${(campaign.impressions/1000).toFixed(0)}K</div>
                            <div style="font-size: 11px;">Impressions</div>
                        </div>
                        <div class="campaign-metric">
                            <div class="metric-number">${campaign.ctr}%</div>
                            <div style="font-size: 11px;">CTR</div>
                        </div>
                        <div class="campaign-metric">
                            <div class="metric-number">$${campaign.cpc}</div>
                            <div style="font-size: 11px;">CPC</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function initializeCampaignChart() {
            const ctx = document.getElementById('campaignChart').getContext('2d');
            const campaigns = [];
            competitors.forEach(c => {
                if (c.campaigns) campaigns.push(...c.campaigns.map(camp => ({...camp, competitor: c.name})));
            });
            
            campaignChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Campaign Performance',
                        data: campaigns.map(c => ({x: parseFloat(c.ctr), y: c.conversions, label: c.name})),
                        backgroundColor: 'rgba(6, 182, 212, 0.6)',
                        borderColor: '#06b6d4'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: { display: true, text: 'Campaign CTR vs Conversions' },
                        tooltip: {
                            callbacks: {
                                label: (context) => {
                                    const campaign = campaigns[context.dataIndex];
                                    return `${campaign.name}: CTR ${campaign.ctr}%, ${campaign.conversions} conversions`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: { title: { display: true, text: 'CTR (%)' } },
                        y: { title: { display: true, text: 'Conversions' } }
                    }
                }
            });
        }

        function updateCampaignChart() {
            const campaigns = [];
            competitors.forEach(c => {
                if (c.campaigns) campaigns.push(...c.campaigns.map(camp => ({...camp, competitor: c.name})));
            });
            
            campaignChart.data.datasets[0].data = campaigns.map(c => ({x: parseFloat(c.ctr), y: c.conversions, label: c.name}));
            campaignChart.update();
        }

        function initializeROIChart() {
            const ctx = document.getElementById('roiChart').getContext('2d');
            
            roiChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: competitors.map(c => c.name),
                    datasets: [{
                        data: competitors.map(c => c.metrics.adSpend),
                        backgroundColor: ['#8b5cf6', '#06b6d4', '#10b981', '#f59e0b', '#ef4444']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: { display: true, text: 'Market Share by Ad Spend' }
                    }
                }
            });
        }

        function initializeBudgetChart() {
            const ctx = document.getElementById('budgetChart').getContext('2d');
            
            fetch('/api/budget')
                .then(response => response.json())
                .then(budgetData => {
                    const competitorSpend = competitors.reduce((sum, c) => sum + c.metrics.adSpend, 0);
                    
                    budgetChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['Your Budget', 'Competitor Average', 'Market Leader'],
                            datasets: [{
                                label: 'Monthly Spend ($K)',
                                data: [
                                    budgetData.totalBudget / 1000,
                                    competitorSpend / competitors.length / 1000,
                                    Math.max(...competitors.map(c => c.metrics.adSpend)) / 1000
                                ],
                                backgroundColor: ['#10b981', '#f59e0b', '#ef4444']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: { display: true, text: 'Budget vs Competitor Spend Analysis' }
                            }
                        }
                    });
                });
        }

        function generateAIInsights() {
            fetch('/api/competitors/ai-insights')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('insightsGrid').innerHTML = data.insights.map(insight => `
                        <div class="insight-card">
                            <div class="insight-title">${insight.title}</div>
                            <div>${insight.content}</div>
                            <div style="margin-top: 10px; font-size: 12px; color: #6b7280;">AI Confidence: ${insight.confidence}%</div>
                        </div>
                    `).join('');
                });
        }

        function loadABTestInsights() {
            fetch('/api/ab-tests')
                .then(response => response.json())
                .then(data => {
                    const insights = data.tests.map(test => {
                        const winner = test.variants.reduce((prev, current) => 
                            prev.conversionRate > current.conversionRate ? prev : current
                        );
                        return {
                            name: test.name,
                            winningRate: winner.conversionRate,
                            improvement: ((winner.conversionRate / test.variants[0].conversionRate - 1) * 100).toFixed(1)
                        };
                    });
                    
                    document.getElementById('abTestInsights').innerHTML = `
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                            ${insights.map(insight => `
                                <div class="insight-card">
                                    <div class="insight-title">${insight.name}</div>
                                    <div>Winning Rate: ${insight.winningRate}%</div>
                                    <div>Improvement: ${insight.improvement}%</div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                });
        }

        function integrateWithExistingFeatures() {
            fetch('/api/utm-analytics')
                .then(response => response.json())
                .then(data => console.log('UTM Analytics integrated:', data.totalClicks));
            
            fetch('/api/performance-scores')
                .then(response => response.json())
                .then(data => console.log('Performance scores integrated:', data.overall.score));
        }

        function generateAIReport() {
            fetch('/api/competitors/generate-report', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    alert(`AI Report Generated!\n\nKey Insights:\n- ${data.insights.join('\n- ')}\n\nReport saved to dashboard.`);
                });
        }

        function exportData() {
            const data = {
                competitors,
                timestamp: new Date().toISOString(),
                summary: {
                    totalCompetitors: competitors.length,
                    totalMarketSpend: competitors.reduce((sum, c) => sum + c.metrics.adSpend, 0)
                }
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `competitor-analysis-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        }

        function scheduleReport() {
            const frequency = prompt('Schedule frequency (daily/weekly/monthly):', 'weekly');
            if (frequency) {
                fetch('/api/reports', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: 'Competitor Analysis Report',
                        frequency,
                        template: 'competitor',
                        recipients: ['team@company.com']
                    })
                })
                .then(response => response.json())
                .then(data => {
                    alert(`Report scheduled successfully! Next run: ${new Date(data.nextRun).toLocaleDateString()}`);
                });
            }
        }

        function generateInsights() {
            const insights = [];
            
            // Top spender
            const topSpender = competitors.reduce((prev, current) => 
                prev.metrics.adSpend > current.metrics.adSpend ? prev : current
            );
            insights.push({
                title: 'Highest Ad Spend',
                content: `${topSpender.name} leads with $${(topSpender.metrics.adSpend / 1000).toFixed(0)}K monthly ad spend`
            });

            // Traffic leader
            const trafficLeader = competitors.reduce((prev, current) => 
                prev.metrics.estimatedTraffic > current.metrics.estimatedTraffic ? prev : current
            );
            insights.push({
                title: 'Traffic Leader',
                content: `${trafficLeader.name} generates ${(trafficLeader.metrics.estimatedTraffic / 1000).toFixed(0)}K monthly visitors`
            });

            // Ranking opportunity
            const avgRank = competitors.reduce((sum, c) => sum + parseFloat(c.metrics.keywordRank), 0) / competitors.length;
            insights.push({
                title: 'Ranking Opportunity',
                content: `Average competitor rank is ${avgRank.toFixed(1)} - opportunity to outrank with targeted SEO`
            });

            // Channel analysis
            const channelCount = {};
            competitors.forEach(c => {
                c.channels.forEach(channel => {
                    channelCount[channel] = (channelCount[channel] || 0) + 1;
                });
            });
            const topChannel = Object.keys(channelCount).reduce((a, b) => channelCount[a] > channelCount[b] ? a : b);
            insights.push({
                title: 'Popular Channel',
                content: `${topChannel.replace('-', ' ')} is used by ${channelCount[topChannel]} competitors - consider increasing presence`
            });

            document.getElementById('insightsGrid').innerHTML = insights.map(insight => `
                <div class="insight-card">
                    <div class="insight-title">${insight.title}</div>
                    <div>${insight.content}</div>
                </div>
            `).join('');
        }

        function viewDetails(competitorId) {
            const competitor = competitors.find(c => c.id === competitorId);
            if (competitor) {
                alert(`Detailed analysis for ${competitor.name}:\n\nWebsite: ${competitor.url}\nIndustry: ${competitor.industry}\nChannels: ${competitor.channels.join(', ')}\n\nMetrics:\n- Ad Spend: $${competitor.metrics.adSpend.toLocaleString()}\n- Traffic: ${competitor.metrics.estimatedTraffic.toLocaleString()}\n- Avg Keyword Rank: ${competitor.metrics.keywordRank}\n- Social Engagement: ${competitor.metrics.socialEngagement.toLocaleString()}`);
            }
        }

        function removeCompetitor(competitorId) {
            if (confirm('Are you sure you want to stop tracking this competitor?')) {
                competitors = competitors.filter(c => c.id !== competitorId);
                displayCompetitors();
                displayPublicCampaigns();
                updateCompetitorChart();
                updateCampaignChart();
                if (roiChart) roiChart.destroy();
                if (budgetChart) budgetChart.destroy();
                initializeROIChart();
                initializeBudgetChart();
                generateAIInsights();
            }
        }

        function updateSettings() {
            const frequency = document.getElementById('updateFrequency').value;
            const threshold = document.getElementById('alertThreshold').value;
            const method = document.getElementById('notificationMethod').value;
            
            alert(`Settings updated:\n- Update Frequency: ${frequency}\n- Alert Threshold: ${threshold}%\n- Notifications: ${method}`);
        }

        function startRealTimeUpdates() {
            setInterval(() => {
                competitors.forEach(competitor => {
                    // Simulate metric updates
                    const spendChange = (Math.random() - 0.5) * 1000;
                    const trafficChange = (Math.random() - 0.5) * 5000;
                    const engagementChange = (Math.random() - 0.5) * 200;
                    
                    competitor.metrics.adSpend = Math.max(1000, competitor.metrics.adSpend + spendChange);
                    competitor.metrics.estimatedTraffic = Math.max(10000, competitor.metrics.estimatedTraffic + trafficChange);
                    competitor.metrics.socialEngagement = Math.max(500, competitor.metrics.socialEngagement + engagementChange);
                    
                    // Update trends
                    competitor.metrics.adSpendTrend = (Math.random() > 0.5 ? '+' : '-') + Math.floor(Math.random() * 20) + '%';
                    competitor.metrics.trafficTrend = (Math.random() > 0.5 ? '+' : '-') + Math.floor(Math.random() * 15) + '%';
                    competitor.metrics.engagementTrend = (Math.random() > 0.5 ? '+' : '-') + Math.floor(Math.random() * 25) + '%';
                });
                
                displayCompetitors();
                displayPublicCampaigns();
                updateCompetitorChart();
                updateCampaignChart();
                generateInsights();
            }, 60000); // Update every minute
        }
    </script>
</body>
</html>